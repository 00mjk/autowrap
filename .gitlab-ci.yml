before_script:
  - "cd ./csharp/library/"
  - "git submodule sync --recursive"
  - "git clean -fdx"
  - "git submodule update --init --recursive"

stages:
  - native
  - dotnet
  - cleanup

Build Autowrap CSharp Linux x64 Native:
  stage: native
  tags:
    - linux
    - dmd
    - dub 
  only:
    - csharp

  script:
    - "dub build --arch=x86_64 --force"
    - "mv libautowrap-support.so ../../libautowrap.x64.so"

  artifacts:
    paths:
    - libautowrap.x64.so
    expire_in: 1 week

Build Autowrap CSharp Linux x86 Native:
  stage: native
  tags:
    - linux
    - dmd
    - dub 
  only:
    - csharp

  script:
    - "dub build --arch=x86 --force"
    - "mv libautowrap-support.so ../../libautowrap.x86.so"

  artifacts:
    paths:
    - libautowrap.x86.so
    expire_in: 1 week

Build Autowrap CSharp Windows x64 Native:
  stage: native
  tags:
    - windows
    - dmd
    - dub 
  only:
    - csharp

  script:
    - "dub build --arch=x86_64 --force"
    - "move autowrap-support.dll ..\\..\\autowrap.x64.dll"

  artifacts:
    paths:
    - autowrap.x64.dll
    expire_in: 1 week

Build Autowrap CSharp Windows x86 Native:
  stage: native
  tags:
    - windows
    - dmd
    - dub 
  only:
    - csharp

  script:
    - "dub build --arch=x86 --force"
    - "move autowrap-support.dll ..\\..\\autowrap.x86.dll"

  artifacts:
    paths:
    - autowrap.x86.dll
    expire_in: 1 week

Build Autowrap CSharp .NET Library:
  stage: dotnet
  tags:
    - linux
    - dotnet
  only:
    - csharp

  script:
    - "mv ../../libautowrap.x64.so libautowrap.x64.so"
    - "mv ../../libautowrap.x86.so libautowrap.x86.so"
    - "mv ../../autowrap.x64.dll autowrap.x64.dll"
    - "mv ../../autowrap.x86.dll autowrap.x86.dll"
    - "dotnet build"
    - "dotnet pack"
